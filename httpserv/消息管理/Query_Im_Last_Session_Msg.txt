*** Settings ***
Documentation     body为json格式，各个字段解释如下：
...
...               "SendID" \ 发送用户ID，app内唯一，字符串
...
...               "RecvID" \ 接收用户ID，app内唯一，字符串
...
...               "CurMsgId" 消息序号，通常用于分页查询，表示64位整型的字符串
...
...               "Limit" \ 本次查询的消息条数上限(最多100条)，小于等于0或者大于100会提示参数错误，整型
...
...               body实例
...
...               {
...               "SendID": "528",
...               "RecvID": "526",
...               " CurMsgId": 0,
...               "Limit": 100
...               }
Force Tags        Query_Im_Last_Session_Msg
Default Tags      session
Library           RequestsLibrary
Library           Collections
Library           ../lib/YouMeAnchorRankLib.py
Library           ../lib/YouMeRequestLib.py

*** Variables ***
${SECRET}         uQAuo9xbYOevRl7oyTm0kR60WMoLDmIzgucehu8lkV0Y2ZKOEP84Y5cWyliGlns0nJK2kgDDGEsCsi/SUWnn0jKQ0REteItDMn/5rihp+Dd8I0V1FMcMeXTSPWDcV+lTiF9so2bpIpLsMlUdHGUVkUMIdUv6vgmtZflkfALM6AMBAAE=    # 用于sha1加密的 秘钥
${APPKEY}         YOUME3C8DDD417211056AAEC1A518FBA43F34577EC958    # 应用标识
${URL}            http://106.75.14.78:18080/

*** Test Cases ***
查询用户最近会话消息
    [Documentation]    body实例
    ...
    ...    {
    ...    "SendID": "528",
    ...    "RecvID": "526",
    ...    " CurMsgId": 0,
    ...    "Limit": 100
    ...    }
    [Tags]    smoke
    log    Query_Im_Last_Session_Msg
    ${SendID}    Convert To Integer    528
    ${RecvID}    Convert To Integer    526
    ${CurMsgId}    Convert To Integer    0
    ${Limit}    Convert To Integer    100
    ${data}    Create Dictionary    SendID=${SendID}    RecvID=${RecvID}    CurMsgId=${CurMsgId}    Limit=${Limit}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary should contain Item    ${res1}    ActionStatus    OK
    Dictionary should contain Item    ${res1}    ErrorCode    0

sendID为空
    log    Query_Im_Last_Session_Msg
    ${RecvID}    Convert To Integer    526
    ${CurMsgId}    Convert To Integer    0
    ${Limit}    Convert To Integer    100
    ${data}    Create Dictionary    SendID=    RecvID=${RecvID}    CurMsgId=${CurMsgId}    Limit=${Limit}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary should contain Item    ${res1}    ActionStatus    FAIL
    Dictionary should contain Item    ${res1}    ErrorCode    70011

RecvID为空
    log    Query_Im_Last_Session_Msg
    ${SendID}    Convert To Integer    528
    ${CurMsgId}    Convert To Integer    0
    ${Limit}    Convert To Integer    100
    ${data}    Create Dictionary    SendID=${SendID}    RecvID=    CurMsgId=${CurMsgId}    Limit=${Limit}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary should contain Item    ${res1}    ActionStatus    FAIL
    Dictionary should contain Item    ${res1}    ErrorCode    70012

CurMsgld为空
    log    Query_Im_Last_Session_Msg
    ${SendID}    Convert To Integer    528
    ${RecvID}    Convert To Integer    526
    ${Limit}    Convert To Integer    100
    ${data}    Create Dictionary    SendID=${SendID}    RecvID=${RecvID}    CurMsgId=    Limit=${Limit}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary should contain Item    ${res1}    ActionStatus    OK
    Dictionary should contain Item    ${res1}    ErrorCode    0

Limit为空
    log    Query_Im_Last_Session_Msg
    ${SendID}    Convert To Integer    528
    ${RecvID}    Convert To Integer    526
    ${CurMsgId}    Convert To Integer    0
    ${data}    Create Dictionary    SendID=${SendID}    RecvID=${RecvID}    CurMsgId=${CurMsgId}    Limit=
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary should contain Item    ${res1}    ActionStatus    FAIL
    Dictionary should contain Item    ${res1}    ErrorCode    70001

发送IM消息查询消息
    [Documentation]    操作步骤：
    ...
    ...    1，发送IM消息查询消息
    log    Query_Im_Last_Session_Msg
    Send User Message    user123    user456
    Send User Message    user123    user456
    ${CurMsgld}    Convert To Integer    0
    ${Limit}    Convert To Integer    10
    ${data}    Create Dictionary    SendID=user123    RecvID=user456    CurMsgId=${CurMsgld}    Limit=${Limit}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary should contain Item    ${res1}    ActionStatus    OK
    Dictionary should contain Item    ${res1}    ErrorCode    0
    Dictionary Should Contain Key    ${res1}    msg_total
    Dictionary Should Contain Key    ${res1}    msg_cnt

发送消息查询再次发送消息查询
    log    Query_Im_Last_Session_Msg
    Send User Message    user123    user456
    Send User Message    user123    user456
    ${CurMsgld}    Convert To Integer    0
    ${Limit}    Convert To Integer    10
    ${data}    Create Dictionary    SendID=user123    RecvID=user456    CurMsgId=${CurMsgld}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Send User Message    user234    user421
    Send User Message    user123    user456
    ${CurMsgld}    Convert To Integer    0
    ${Limit}    Convert To Integer    10
    ${data}    Create Dictionary    SendID=user123    RecvID=user456    CurMsgId=${CurMsgld}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary Should Contain Item    ${res1}    ActionStatus    FAIL
    Dictionary Should Contain Item    ${res1}    ErrorCode    70007
    Dictionary Should Contain Item    ${res1}    ErrorInfo    invalid msg limit

用户向频道发送消息，查询用户消息
    log    Query_Im_Last_Session_Msg
    Send Channel Message    user999    channel777
    ${CurMsgld}    Convert To Integer    0
    ${Limit}    Convert To Integer    10
    ${data}    Create Dictionary    SendID=user999    RecvID=channel777    CurMsgId=${CurMsgld}
    ${res1}    Post Data    ${URL}    v1/im/query_im_last_session_msg    ${data}
    Dictionary Should Contain Item    ${res1}    ActionStatus    FAIL
    Dictionary Should Contain Item    ${res1}    ErrorCode    70007
    Dictionary Should Contain Item    ${res1}    ErrorInfo    invalid msg limit

*** Keywords ***
Send User Message
    [Arguments]    ${SendID}    ${RecvID}
    [Documentation]    query_im_send_msg
    ${MsgSeq}    Convert To Integer    99807732
    ${ChatType}    Convert To Integer    1
    ${data}    Create Dictionary    MsgSeq=${MsgSeq}    ChatType=${ChatType}    SendID=${SendID}    RecvID=${RecvID}    Content=asdfgsdgdsfgr
    ${res1}    Post Data    ${URL}    v1/im/query_im_send_msg    ${data}

Send Channel Message
    [Arguments]    ${SendID}    ${RecvID}
    ${MsgSeq}    Convert To Integer    99807732
    ${ChatType}    Convert To Integer    2
    ${data}    Create Dictionary    MsgSeq=${MsgSeq}    ChatType=${ChatType}    SendID=${SendID}    RecvID=${RecvID}    Content=asdfgsdgdsfgr
    ${res1}    Post Data    ${URL}    v1/im/query_im_send_msg    ${data}
